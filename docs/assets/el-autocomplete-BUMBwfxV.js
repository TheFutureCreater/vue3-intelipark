import{F as ge,Y as j,ax as me,X as V,a1 as be,j as Y,bf as he,k as ye,r as d,s as $,bw as Ee,N as we,o as S,g as $e,w as f,b as G,v as A,e as t,x as Q,d as I,c as _,m as b,Q as Se,bo as Ae,U as Ie,ay as Ne,f as Ce,a7 as Te,n as ke,az as E,an as X,aI as Fe,_ as Be,aw as D,y as Pe}from"./index-_q3JvgRk.js";import{U as N,I as O,C as J,u as Ve,E as _e,t as De}from"./el-input-A4IIEm7f.js";import{E as Oe}from"./el-scrollbar-Cv1oxCIh.js";import{b as Ke,E as Le}from"./el-popper-CqmaK_26.js";import{u as Re,b as Me,a as Ue}from"./constants-DMP6LdFp.js";import{d as We}from"./debounce-DmkIbiIw.js";const ze=ge({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:j(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:j([Function,Array]),default:me},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ke.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...Re(["ariaLabel"])}),He={[N]:l=>V(l),[O]:l=>V(l),[J]:l=>V(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent,clear:()=>!0,select:l=>be(l)},qe=["aria-expanded","aria-owns"],je={key:0},Ge=["id","aria-selected","onClick"],Z="ElAutocomplete",Qe=Y({name:Z,inheritAttrs:!1}),Xe=Y({...Qe,props:ze,emits:He,setup(l,{expose:x,emit:u}){const o=l,ee=Me(),te=he(),K=Ve(),c=ye("autocomplete"),n=d(),L=d(),C=d(),R=d();let M=!1,T=!1;const i=d([]),s=d(-1),U=d(""),p=d(!1),w=d(!1),g=d(!1),h=Ue(),ae=$(()=>te.style),v=$(()=>(i.value.length>0||g.value)&&p.value),W=$(()=>!o.hideLoading&&g.value),se=$(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),le=()=>{v.value&&(U.value=`${n.value.$el.offsetWidth}px`)},oe=()=>{s.value=-1},z=We(async e=>{if(w.value)return;const a=r=>{g.value=!1,!w.value&&(D(r)?(i.value=r,s.value=o.highlightFirstItem?0:-1):De(Z,"autocomplete suggestions must be an array"))};if(g.value=!0,D(o.fetchSuggestions))a(o.fetchSuggestions);else{const r=await o.fetchSuggestions(e,a);D(r)&&a(r)}},o.debounce),ne=e=>{const a=!!e;if(u(O,e),u(N,e),w.value=!1,p.value||(p.value=a),!o.triggerOnFocus&&!e){w.value=!0,i.value=[];return}z(e)},re=e=>{var a;K.value||(((a=e.target)==null?void 0:a.tagName)!=="INPUT"||se.value.includes(document.activeElement))&&(p.value=!0)},ue=e=>{u(J,e)},ie=e=>{T?T=!1:(p.value=!0,u("focus",e),o.triggerOnFocus&&!M&&z(String(o.modelValue)))},ce=e=>{setTimeout(()=>{var a;if((a=C.value)!=null&&a.isFocusInsideContent()){T=!0;return}p.value&&y(),u("blur",e)})},de=()=>{p.value=!1,u(N,""),u("clear")},H=async()=>{v.value&&s.value>=0&&s.value<i.value.length?k(i.value[s.value]):o.selectWhenUnmatched&&(u("select",{value:o.modelValue}),i.value=[],s.value=-1)},pe=e=>{v.value&&(e.preventDefault(),e.stopPropagation(),y())},y=()=>{p.value=!1},fe=()=>{var e;(e=n.value)==null||e.focus()},ve=()=>{var e;(e=n.value)==null||e.blur()},k=async e=>{u(O,e[o.valueKey]),u(N,e[o.valueKey]),u("select",e),i.value=[],s.value=-1},F=e=>{if(!v.value||g.value)return;if(e<0){s.value=-1;return}e>=i.value.length&&(e=i.value.length-1);const a=L.value.querySelector(`.${c.be("suggestion","wrap")}`),m=a.querySelectorAll(`.${c.be("suggestion","list")} li`)[e],B=a.scrollTop,{offsetTop:q,scrollHeight:P}=m;q+P>B+a.clientHeight&&(a.scrollTop+=P),q<B&&(a.scrollTop-=P),s.value=e,n.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${s.value}`)};return Ee(R,()=>{v.value&&y()}),we(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${s.value}`),M=n.value.ref.hasAttribute("readonly")}),x({highlightedIndex:s,activated:p,loading:g,inputRef:n,popperRef:C,suggestions:i,handleSelect:k,handleKeyEnter:H,focus:fe,blur:ve,close:y,highlight:F}),(e,a)=>(S(),$e(t(Le),{ref_key:"popperRef",ref:C,visible:t(v),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(c).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(c).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:le,onHide:oe},{content:f(()=>[G("div",{ref_key:"regionRef",ref:L,class:A([t(c).b("suggestion"),t(c).is("loading",t(W))]),style:Q({[e.fitInputWidth?"width":"minWidth"]:U.value,outline:"none"}),role:"region"},[I(t(Oe),{id:t(h),tag:"ul","wrap-class":t(c).be("suggestion","wrap"),"view-class":t(c).be("suggestion","list"),role:"listbox"},{default:f(()=>[t(W)?(S(),_("li",je,[b(e.$slots,"loading",{},()=>[I(t(Se),{class:A(t(c).is("loading"))},{default:f(()=>[I(t(Ae))]),_:1},8,["class"])])])):(S(!0),_(Ie,{key:1},Ne(i.value,(r,m)=>(S(),_("li",{id:`${t(h)}-item-${m}`,key:m,class:A({highlighted:s.value===m}),role:"option","aria-selected":s.value===m,onClick:B=>k(r)},[b(e.$slots,"default",{item:r},()=>[Ce(Te(r[e.valueKey]),1)])],10,Ge))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:f(()=>[G("div",{ref_key:"listboxRef",ref:R,class:A([t(c).b(),e.$attrs.class]),style:Q(t(ae)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(v),"aria-owns":t(h)},[I(t(_e),ke({ref_key:"inputRef",ref:n},t(ee),{clearable:e.clearable,disabled:t(K),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ne,onChange:ue,onFocus:ie,onBlur:ce,onClear:de,onKeydown:[a[0]||(a[0]=E(X(r=>F(s.value-1),["prevent"]),["up"])),a[1]||(a[1]=E(X(r=>F(s.value+1),["prevent"]),["down"])),E(H,["enter"]),E(y,["tab"]),E(pe,["esc"])],onMousedown:re}),Fe({_:2},[e.$slots.prepend?{name:"prepend",fn:f(()=>[b(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:f(()=>[b(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:f(()=>[b(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[b(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,qe)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var Ye=Be(Xe,[["__file","autocomplete.vue"]]);const lt=Pe(Ye);export{lt as E};
