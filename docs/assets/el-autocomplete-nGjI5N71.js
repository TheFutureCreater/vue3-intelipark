import{C as ye,W as le,au as be,V as x,$ as Se,i as ce,b7 as Ce,j as Ee,r as s,q as N,bo as we,K as Ie,J as De,o as O,f as $e,w as I,a as re,s as V,d as r,v as ue,b as q,c as ee,k as M,M as Te,bg as Re,P as Me,av as Ae,e as ke,a5 as Le,m as _e,aw as B,al as ie,aF as Fe,_ as Be,at as te,n as Ne,aK as S,ai as Pe,co as Oe}from"./index-BYnOmLgs.js";import{U as H,I as ae,C as de,b as Ve,E as qe,t as He}from"./el-input-f41vfBh9.js";import{E as Ke}from"./el-scrollbar-DV6-zTQg.js";import{e as Ue,E as Ge}from"./el-popper-BrjVVlda.js";import{u as We,b as Ye,a as ze}from"./constants-CvswaA_c.js";import{d as je}from"./debounce-CbyCVUEG.js";import{f as Je}from"./station-FXa3q6gL.js";const Qe=ye({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:le(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:le([Function,Array]),default:be},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:Ue.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...We(["ariaLabel"])}),Xe={[H]:t=>x(t),[ae]:t=>x(t),[de]:t=>x(t),focus:t=>t instanceof FocusEvent,blur:t=>t instanceof FocusEvent,clear:()=>!0,select:t=>Se(t)},ge="ElAutocomplete",Ze=ce({name:ge,inheritAttrs:!1}),xe=ce({...Ze,props:Qe,emits:Xe,setup(t,{expose:p,emit:i}){const c=t,A=Ye(),K=Ce(),k=Ve(),v=Ee("autocomplete"),d=s(),L=s(),D=s(),C=s();let $=!1,T=!1;const g=s([]),a=s(-1),_=s(""),f=s(!1),y=s(!1),E=s(!1),w=ze(),U=N(()=>K.style),b=N(()=>(g.value.length>0||E.value)&&f.value),P=N(()=>!c.hideLoading&&E.value),G=N(()=>d.value?Array.from(d.value.$el.querySelectorAll("input")):[]),W=()=>{b.value&&(_.value=`${d.value.$el.offsetWidth}px`)},Y=()=>{a.value=-1},z=async e=>{if(y.value)return;const u=h=>{E.value=!1,!y.value&&(te(h)?(g.value=h,a.value=c.highlightFirstItem?0:-1):He(ge,"autocomplete suggestions must be an array"))};if(E.value=!0,te(c.fetchSuggestions))u(c.fetchSuggestions);else{const h=await c.fetchSuggestions(e,u);te(h)&&u(h)}},j=je(z,c.debounce),o=e=>{const u=!!e;if(i(ae,e),i(H,e),y.value=!1,f.value||(f.value=u),!c.triggerOnFocus&&!e){y.value=!0,g.value=[];return}j(e)},n=e=>{var u;k.value||(((u=e.target)==null?void 0:u.tagName)!=="INPUT"||G.value.includes(document.activeElement))&&(f.value=!0)},l=e=>{i(de,e)},m=e=>{T?T=!1:(f.value=!0,i("focus",e),c.triggerOnFocus&&!$&&j(String(c.modelValue)))},fe=e=>{setTimeout(()=>{var u;if((u=D.value)!=null&&u.isFocusInsideContent()){T=!0;return}f.value&&F(),i("blur",e)})},pe=()=>{f.value=!1,i(H,""),i("clear")},se=async()=>{b.value&&a.value>=0&&a.value<g.value.length?J(g.value[a.value]):c.selectWhenUnmatched&&(i("select",{value:c.modelValue}),g.value=[],a.value=-1)},ve=e=>{b.value&&(e.preventDefault(),e.stopPropagation(),F())},F=()=>{f.value=!1},he=()=>{var e;(e=d.value)==null||e.focus()},me=()=>{var e;(e=d.value)==null||e.blur()},J=async e=>{i(ae,e[c.valueKey]),i(H,e[c.valueKey]),i("select",e),g.value=[],a.value=-1},Q=e=>{if(!b.value||E.value)return;if(e<0){a.value=-1;return}e>=g.value.length&&(e=g.value.length-1);const u=L.value.querySelector(`.${v.be("suggestion","wrap")}`),R=u.querySelectorAll(`.${v.be("suggestion","list")} li`)[e],X=u.scrollTop,{offsetTop:ne,scrollHeight:Z}=R;ne+Z>X+u.clientHeight&&(u.scrollTop+=Z),ne<X&&(u.scrollTop-=Z),a.value=e,d.value.ref.setAttribute("aria-activedescendant",`${w.value}-item-${a.value}`)},oe=we(C,()=>{b.value&&F()});return Ie(()=>{oe==null||oe()}),De(()=>{d.value.ref.setAttribute("role","textbox"),d.value.ref.setAttribute("aria-autocomplete","list"),d.value.ref.setAttribute("aria-controls","id"),d.value.ref.setAttribute("aria-activedescendant",`${w.value}-item-${a.value}`),$=d.value.ref.hasAttribute("readonly")}),p({highlightedIndex:a,activated:f,loading:E,inputRef:d,popperRef:D,suggestions:g,handleSelect:J,handleKeyEnter:se,focus:he,blur:me,close:F,highlight:Q,getData:z}),(e,u)=>(O(),$e(r(Ge),{ref_key:"popperRef",ref:D,visible:r(b),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[r(v).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${r(v).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:W,onHide:Y},{content:I(()=>[re("div",{ref_key:"regionRef",ref:L,class:V([r(v).b("suggestion"),r(v).is("loading",r(P))]),style:ue({[e.fitInputWidth?"width":"minWidth"]:_.value,outline:"none"}),role:"region"},[q(r(Ke),{id:r(w),tag:"ul","wrap-class":r(v).be("suggestion","wrap"),"view-class":r(v).be("suggestion","list"),role:"listbox"},{default:I(()=>[r(P)?(O(),ee("li",{key:0},[M(e.$slots,"loading",{},()=>[q(r(Te),{class:V(r(v).is("loading"))},{default:I(()=>[q(r(Re))]),_:1},8,["class"])])])):(O(!0),ee(Me,{key:1},Ae(g.value,(h,R)=>(O(),ee("li",{id:`${r(w)}-item-${R}`,key:R,class:V({highlighted:a.value===R}),role:"option","aria-selected":a.value===R,onClick:X=>J(h)},[M(e.$slots,"default",{item:h},()=>[ke(Le(h[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:I(()=>[re("div",{ref_key:"listboxRef",ref:C,class:V([r(v).b(),e.$attrs.class]),style:ue(r(U)),role:"combobox","aria-haspopup":"listbox","aria-expanded":r(b),"aria-owns":r(w)},[q(r(qe),_e({ref_key:"inputRef",ref:d},r(A),{clearable:e.clearable,disabled:r(k),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:o,onChange:l,onFocus:m,onBlur:fe,onClear:pe,onKeydown:[B(ie(h=>Q(a.value-1),["prevent"]),["up"]),B(ie(h=>Q(a.value+1),["prevent"]),["down"]),B(se,["enter"]),B(F,["tab"]),B(ve,["esc"])],onMousedown:n}),Fe({_:2},[e.$slots.prepend?{name:"prepend",fn:I(()=>[M(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:I(()=>[M(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:I(()=>[M(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:I(()=>[M(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var et=Be(xe,[["__file","autocomplete.vue"]]);const pt=Ne(et),tt=t=>S({url:`/chargingRecords/all/${t}`,method:"GET"}),vt=(t,p)=>S({url:`/chargingRecords/subsectionsCount/${t}`,method:"GET",params:{date:p}}),at=t=>S({url:"/connections/count",method:"GET",params:{parkId:t}}),ht=t=>S({url:`/connections/occupy/${t}`,method:"GET"}),st=t=>S({url:`/connections/useRate/${t}`}),ot=(t,p)=>S({url:"/chargingRecords/top",method:"GET",params:{startDate:t,endDate:p}}),mt=()=>S({url:"/person/count",method:"GET"}),nt=(t,p,i)=>S({url:"/stats",method:"GET",params:{parkId:t,startDate:p,endDate:i}}),lt=(t,p,i)=>S({url:`/chargingRecords/costCount/${t}`,method:"GET",params:{startDate:p,endDate:i}}),yt=Pe("defSceenInfo",()=>{const t=s(0),p=Oe(),i=s(0),c=s(0),A=s({fastTotal:0,slowTotal:0}),K=s(p.query.parkid),k=s(),v=s([]),d=s([]),L=s([]),D=s(0),C=s(""),$=s(""),T=s(""),g=s(""),a=s(),_=s(),f=s({chargingRecordSum:0,electricitySum:0,chargeHoursSum:0,chargingRecordCountArray:[]}),y=s({chargingRecordSum:0,electricitySum:0,chargeHoursSum:0,chargingRecordCountArray:[]}),E=N(()=>D.value/100),w=()=>{let o=new Date;C.value=o.getFullYear()+"-"+(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"+(o.getDate()<10?"0"+o.getDate():o.getDate());let n=new Date;n.setDate(o.getDate()-6),$.value=n.getFullYear()+"-"+(n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"-"+(n.getDate()<10?"0"+n.getDate():n.getDate());let l=new Date;l.setMonth(o.getMonth()-1),g.value=l.getFullYear()+"-"+(l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1)+"-"+(l.getDate()<10?"0"+l.getDate():l.getDate());let m=new Date;m.setMonth(o.getMonth()-5),m.setDate(1),T.value=m.getFullYear()+"-"+(m.getMonth()+1<10?"0"+(m.getMonth()+1):m.getMonth()+1)+"-"+(m.getDate()<10?"0"+m.getDate():m.getDate())};async function U(o){try{w(),a.value=(await nt(o,T.value,C.value)).data.data;let n=a.value.dateCountList.length,l=0;for(l=30;l>=0&&l<n;l--)l<7&&(f.value.chargingRecordSum+=parseInt(a.value.dateCountList[n-l-1].chargingRecordCount),f.value.chargingRecordCountArray.push(a.value.dateCountList[n-l-1].chargingRecordCount),f.value.chargeHoursSum+=parseInt(a.value.dateCountList[n-l-1].chargeHours),f.value.electricitySum+=a.value.dateCountList[n-l-1].electricityCount),y.value.chargingRecordSum+=parseInt(a.value.dateCountList[n-l-1].chargingRecordCount),y.value.chargingRecordCountArray.push(a.value.dateCountList[n-l-1].chargingRecordCount),y.value.chargeHoursSum+=parseInt(a.value.dateCountList[n-l-1].chargeHours),y.value.electricitySum+=a.value.dateCountList[n-l-1].electricityCount}catch(n){alert("refresh_stats error"),console.log(n)}}const b=async o=>{_.value=(await lt(o,t.value==0?$.value:g.value,C.value)).data.data};async function P(){}async function G(o){k.value=(await at(o)).data.data}async function W(){d.value=(await ot(t.value==0?$.value:g.value,C.value)).data.data}async function Y(o){L.value=(await tt(o)).data.data}return{days:t,today:C,stats:a,parkid:K,stationId:c,routes:p,EqState:k,userList:d,preOneWeek:$,preOneMonth:g,preSixMonth:T,chargingInfo:L,detailDaysId:i,incomeInfo:_,connectorStatus:A,eqUsingRate:D,latestWeekInfo:f,latestMonthInfo:y,chargingOrderState:v,refresh_crgOdrState:P,refresh_eqState:G,refresh_userList:W,refresh_crgInfo:Y,refresh_usingRate:async o=>{const n=await st(o);D.value=n.data.data},refresh_userIncomeInfo:b,dateInit:w,refresh_stats:U,refresh_ConnectorStatus:async()=>{const o=(await Je(c.value)).data.data;A.value.slowTotal=o.slowTotal,A.value.fastTotal=o.fastTotal},rate:E}});export{pt as E,mt as a,vt as b,ht as g,yt as u};
